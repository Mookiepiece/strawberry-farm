import{d as S,f as h,G as F,a9 as I,z as M,A as z,a8 as L,c as y,o as i,i as d,F as _,j as g,x as w,l as N,n as K,a0 as $,m as G,r as P,I as T,t as U,a as D,$ as q}from"./framework.IAuM8QuA.js";import{f as H}from"./misc.C9Tk6PVQ.js";import{w as J}from"./theme.DZqSg4PV.js";const O=S(s=>{if(!s.forwardRef)return()=>s.render();const u=h();return F(()=>{s.forwardRef(u)}),()=>{var c;const t=s.render(),n=Array.isArray(t)?t[0]:t;return(c=n.props)!=null&&c.ref&&console.warn("[StrawberryFarm] refs are forwarded."),I(n,{ref:u})}},{name:"RenderFunction",props:["forwardRef","render"]}),Q=["id","tabindex","aria-disabled","aria-activedescendant","aria-multiselectable"],W=["aria-label"],ee=S({__name:"VListbox",props:M({clearable:{type:Boolean},magnetic:{type:Boolean},options:{},disabled:{type:Boolean},class:{},style:{type:[Boolean,null,String,Object,Array]}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s,{expose:u}){const t=z(s,"modelValue"),n=s,c=L(),v=J(),f=h(0),l=y({get(){const e=H(n.options??[]);return e.some(a=>!a.disabled)?f.value>=0&&f.value<e.length?f.value:0:-1},set(e){f.value=e}}),p=y(()=>Array.isArray(t.value)),j=y(()=>{let e=0;const o=a=>{var V;const r=typeof a=="object"&&a?a.value:a,m=e++;return{label:typeof a=="object"&&a?a.label??a.value:""+a,value:r,meta:typeof a=="object"&&a?a.meta:void 0,disabled:typeof a=="object"&&a&&a.disabled||!1,index:m,selected:p.value?(V=t.value)==null?void 0:V.includes(r):r===t.value,current:l.value===m}};return(n.options??[]).map(a=>a&&typeof a=="object"&&"options"in a?{...a,options:a.options.map(o)}:o(a))}),b=y(()=>j.value.flatMap(e=>e&&typeof e=="object"&&"options"in e?e.options:e)),x=e=>{if(p.value){if(!t.value)return;t.value.includes(e)?t.value.splice(t.value.indexOf(e),1):t.value.push(e),t.value=t.value;return}n.clearable&&t.value===e?t.value=null:t.value=e},A=h(null),k=new IntersectionObserver(([e])=>{(e.intersectionRatio||0)<1&&e.target.scrollIntoView({block:"center",inline:"center"}),k.disconnect()}),B=e=>{const o=b.value.slice(0,l.value),r=[...b.value.slice(l.value+1),...o][e<0?"findLast":"find"](m=>!m.disabled);r&&(l.value=b.value.indexOf(r),k.disconnect(),k.observe(document.getElementById(v+l.value)),!p.value&&!n.magnetic&&x(r.value))},C=()=>{l.value>-1&&x(b.value[l.value].value)},E=e=>{if(!n.disabled)switch(e.key){case"ArrowUp":case"ArrowLeft":e.preventDefault(),B(-1);break;case"ArrowDown":case"ArrowRight":e.preventDefault(),B(1);break;case" ":case"Enter":e.preventDefault(),C();break}};u({el:A});const R=e=>{var o;return q("div",{id:v+e.index,onClick:e.disabled?void 0:()=>x(e.value),role:"option","aria-selected":e.selected||void 0,"aria-current":e.current||void 0,onPointermove:n.magnetic?()=>void(l.value=e.index):void 0,"aria-disabled":n.disabled||e.disabled||void 0},((o=c.default)==null?void 0:o.call(c,{option:e}))||e.label)};return(e,o)=>(i(),d("div",{ref_key:"el",ref:A,id:w(v),style:N(n.style),class:K(n.class),onKeydown:$(E,["self","exact"]),role:"listbox",tabindex:n.disabled?-1:0,"aria-disabled":n.disabled,"aria-activedescendant":l.value>-1?w(v)+l.value:void 0,"aria-multiselectable":p.value},[(i(!0),d(_,null,g(j.value,a=>(i(),d(_,{key:a&&typeof a=="object"&&"options"in a?"g"+a.label:"i"+a.value},[a&&typeof a=="object"&&"options"in a?(i(),d("div",{key:0,role:"group","aria-label":a.label},[G("h6",null,[P(e.$slots,"title",{group:a},()=>[T(U(a.label),1)])]),(i(!0),d(_,null,g(a.options,r=>(i(),D(w(O),{key:r.value,render:()=>R(r)},null,8,["render"]))),128))],8,W)):(i(),D(w(O),{key:1,render:()=>R(a)},null,8,["render"]))],64))),128))],46,Q))}});export{O as R,ee as _};
