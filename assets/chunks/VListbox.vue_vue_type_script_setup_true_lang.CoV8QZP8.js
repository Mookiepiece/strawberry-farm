import{c as h,a0 as D,d as E,A as M,B as V,f as L,a1 as R,$,o as b,j as k,F as _,k as B,r as C,p as O,t as P,a as I,e as S,y as g,a2 as N,a3 as x,Z as F}from"./framework.qiMOmzvi.js";import{w as H,c as U}from"./theme.CGULKHWn.js";import{u as z}from"./nav.CPGBmk_S.js";const X=e=>e.flatMap(a=>typeof a=="object"&&a&&"title"in a?a.options:a).map(a=>typeof a=="object"&&a?"label"in a?a:{...a,label:String(a.value)}:{value:a,label:String(a)}),Z=(e,a)=>{const f=H(),o=h(()=>X(a.options??[])),w=h(()=>Array.isArray(e.value)),r=h(()=>!!a.disabled),t=h(()=>{let l=0;const s=n=>{const m=typeof n=="object"&&n?n.value:n,A=l++;return{value:m,label:String(typeof n=="object"&&n?n.label??n.value:n),meta:typeof n=="object"&&n?n.meta:void 0,disabled:typeof n=="object"&&n&&n.disabled||!1,index:A}};return(a.options??[]).map(n=>typeof n=="object"&&n&&"options"in n?{...n,options:n.options.map(s)}:s(n))}),v=h(()=>o.value.map((l,s)=>l.disabled?-1:s)),{current:i,nav:c}=z(Math.max(0,o.value.findIndex(l=>!l.disabled&&(Array.isArray(e.value)?e.value.includes(l.value):e.value===l.value))),v),y=(l,s)=>{r.value||c(l,s)===void 0||p()},u=(...l)=>{if(r.value)return;let s=e.value;l.forEach(n=>{let m=n;if(m===d){if(i.value<0)return;m=o.value[i.value].value}const A=o.value.findIndex(j=>j.value===m);if(A<0)return;const K=o.value[A];K!=null&&K.disabled||(Array.isArray(s)?s=s.includes(m)?s.toSpliced(s.indexOf(m),1):[...s,m]:a.clearable&&s===m?s=null:s=m)}),e.value=s},p=(()=>{const l=new IntersectionObserver(([s])=>{(s.intersectionRatio||0)<1&&s.target.scrollIntoView({block:"center",inline:"center"}),l.disconnect()});return()=>{l.disconnect(),l.observe(document.getElementById(f+":"+i.value))}})(),d=D({model:e,id:f,tree:t,multi:w,options:o,current:i,disabled:r,nav:y,input:u});return d},q=["id","tabindex","aria-disabled","aria-activedescendant","aria-multiselectable"],G=["aria-label"],J=e=>Array.isArray(e)?e:[e],Q=e=>{const a=(r,t)=>{if(r<0||t<0)return;const v=e.options.slice(Math.min(r,t),Math.max(r,t)+1),i=new Set(e.model);e.input(...v.map(c=>c.value).filter(c=>!i.has(c)))};let f=-1;return{addRange:a,handlePointerdown:(r,t,{magnetic:v=!0}={})=>{var i;if(!t.disabled)if(e.multi)if(r.shiftKey){(i=document.getSelection())==null||i.removeAllRanges();const c=t.index,y=f>-1&&f||e.current;y>=0&&(e.current=c,a(c,y))}else r.ctrlKey===v?(e.input(t.value),e.current=t.index):(e.input(...e.model,t.value),e.current=t.index);else e.input(t.value),e.current=t.index},handleKeydown:(r,{circular:t=!1,magnetic:v=!0}={})=>{if(!e.disabled)if(r.shiftKey?f=e.current:f=-1,r.shiftKey){if(!e.multi)return;const i=c=>{r.preventDefault(),e.nav(c),a(f,e.current)};switch(r.key){case"ArrowUp":case"ArrowLeft":i(-1);break;case"ArrowDown":case"ArrowRight":i(1);break;case"Home":i(-1/0);break;case"End":i(1/0);break}}else{const i=c=>{if(r.preventDefault(),v===r.ctrlKey)return e.nav(c,t);const y=e.current;e.nav(c,t),y!==e.current&&e.input(...J(e.model),e)};switch(r.key){case"ArrowUp":case"ArrowLeft":i(-1);break;case"ArrowDown":case"ArrowRight":i(1);break;case"Home":i(-1/0);break;case"End":i(1/0);break;case" ":r.preventDefault(),e.input(e);break}}}}},ee=E({__name:"VListbox",props:M({disabled:{type:Boolean},options:{},clearable:{type:Boolean},listbox:{},circular:{type:Boolean},magnetic:{type:Boolean,default:!0},action:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:a}){const f=V(e,"modelValue"),o=e,w=L(),r=R(),t=o.listbox||Z(f,o),v=Q(t),i=$(t,"current"),c=u=>x(r.default&&U(r.default({option:u}))||F("div",u.label),{id:t.id+":"+u.index,onPointerdown:p=>p.shiftKey&&p.preventDefault(),onClick:p=>v.handlePointerdown(p,u,{magnetic:o.magnetic}),role:"option","aria-selected":(Array.isArray(t.model)?t.model.includes(u.value):t.model===u.value)||void 0,class:t.current===u.index&&"current","aria-disabled":o.disabled||u.disabled||void 0}),y=u=>{var p;u.key==="Enter"?o.action?o.action(u,t):(p=w.value.closest("form"))==null||p.submit():v.handleKeydown(u,{circular:o.circular,magnetic:o.magnetic})};return a({listbox:t}),(u,p)=>(b(),k("div",{ref_key:"root",ref:w,id:g(t).id,onKeydown:N(y,["self"]),role:"listbox",tabindex:o.disabled?-1:0,"aria-disabled":o.disabled,"aria-activedescendant":i.value>-1?`${g(t).id}:${i.value}`:void 0,"aria-multiselectable":g(t).multi},[(b(!0),k(_,null,B(g(t).tree,(d,l)=>(b(),k(_,{key:l},[d&&typeof d=="object"&&"options"in d?(b(),k("div",{key:0,role:"group","aria-label":d.title},[C(u.$slots,"group",{group:d},()=>[O("h6",null,P(d.title),1)]),(b(!0),k(_,null,B(d.options,(s,n)=>(b(),I(S(c(s)),{key:n}))),128))],8,G)):(b(),I(S(c(d)),{key:1}))],64))),128))],40,q))}});export{ee as _,Z as u};
