import{f as S,c as h,a4 as V,d as B,A as L,B as T,a5 as O,ab as R,o as w,j as k,F as N,k as _,y as I,r as x,p as F,t as P,a as j,e as D,$,a7 as C,Z as Y}from"./framework.BjwmYqAO.js";import{w as G,g as W}from"./theme.W1H-0ptT.js";const H=(e=0,n)=>{const f=S(e),t=h({get(){const r=f.value;return r<0||r>=n.value.length||n.value[r]<0?n.value.findIndex(a=>a>=0):f.value},set:r=>f.value=r});return{current:t,nav:(r,a=!1)=>{const l=n.value,v=(()=>{switch(r){case-1/0:return l.findIndex(c=>c>=0);case 1/0:return l.findLastIndex(c=>c>=0);case-1:case 1:{const c=!a&&r===1?[]:l.slice(0,t.value),d=!a&&r===-1?[]:l.slice(t.value+1),m=[...d,...c][r<0?"findLastIndex":"findIndex"](i=>i>=0);return m<0?-1:m<d.length?t.value+1+m:m-d.length}default:return-1}})();if(!(v<0))return t.value=v}}},U=e=>e.flatMap(n=>typeof n=="object"&&n&&"title"in n?n.options:n).map(n=>typeof n=="object"&&n?"label"in n?n:{...n,label:String(n.value)}:{value:n,label:String(n)}),z=(e,n)=>{const f=G(),t=h(()=>U(n.options??[])),p=h(()=>Array.isArray(e.value)),r=h(()=>!!n.disabled),a=h(()=>{let s=0;const u=o=>{const b=typeof o=="object"&&o?o.value:o,A=s++;return{value:b,label:String(typeof o=="object"&&o?o.label??o.value:o),meta:typeof o=="object"&&o?o.meta:void 0,disabled:typeof o=="object"&&o&&o.disabled||!1,index:A}};return(n.options??[]).map(o=>typeof o=="object"&&o&&"options"in o?{...o,options:o.options.map(u)}:u(o))}),l=h(()=>t.value.map((s,u)=>s.disabled?-1:u)),{current:v,nav:c}=H(Math.max(0,t.value.findIndex(s=>!s.disabled&&(Array.isArray(e.value)?e.value.includes(s.value):e.value===s.value))),l),d=(s,u)=>{r.value||c(s,u)===void 0||i()},m=(...s)=>{if(r.value)return;let u=e.value;s.forEach(o=>{let b=o;if(b===y){if(v.value<0)return;b=t.value[v.value].value}const A=t.value.findIndex(M=>M.value===b);if(A<0)return;const g=t.value[A];g!=null&&g.disabled||(Array.isArray(u)?u=u.includes(b)?u.toSpliced(u.indexOf(b),1):[...u,b]:n.clearable&&u===b?u=null:u=b)}),e.value=u},i=(()=>{const s=new IntersectionObserver(([u])=>{(u.intersectionRatio||0)<1&&u.target.scrollIntoView({block:"center",inline:"center"}),s.disconnect()});return()=>{s.disconnect(),s.observe(document.getElementById(f+":"+v.value))}})(),y=V({model:e,id:f,tree:a,multi:p,options:t,current:v,disabled:r,nav:d,input:m});return y},X=["id","tabindex","aria-disabled","aria-activedescendant","aria-multiselectable"],Z=["aria-label"],q=e=>{const n=new WeakMap;return f=>n.get(f)||(()=>{const t=e(f);return n.set(f,t),t})()},E=new WeakMap,J=e=>e&&E.get(e)||(()=>{const n=0n,f=new WeakMap,t=p=>typeof p=="symbol"?p:p&&typeof p=="object"?f.get(p)||(()=>{const r="object"+n.toString(36);return f.set(p,r),r})():typeof p+p;return E.set(e,t),t})(),Q=e=>Array.isArray(e)?e:[e],K=q(e=>{const n=(a,l)=>{if(a<0||l<0)return;const v=e.options.slice(Math.min(a,l),Math.max(a,l)+1),c=new Set(e.model);e.input(...v.map(d=>d.value).filter(d=>!c.has(d)))},f=a=>e.options.findIndex(({value:l})=>l===a);let t=-1;return{addRange:n,findIndex:f,getAnchor:()=>t,handlePointerdown:(a,l,{magnetic:v=!0}={})=>{var c;if(!l.disabled)if(e.multi)if(a.shiftKey){(c=document.getSelection())==null||c.removeAllRanges();const d=l.index,m=t>-1&&t||e.current;m>=0&&(e.current=d,K(e).addRange(d,m))}else a.ctrlKey===v?(e.input(l.value),e.current=l.index):(e.input(...e.model,l.value),e.current=l.index);else e.input(l.value),e.current=l.index},handleKeydown:(a,{circular:l=!1,magnetic:v=!0}={})=>{if(!e.disabled)if(a.shiftKey?t=e.current:t=-1,a.shiftKey){if(!e.multi)return;const{nav:c}=e;switch(a.key){case"ArrowUp":case"ArrowLeft":a.preventDefault(),c(-1),n(t,e.current);break;case"ArrowDown":case"ArrowRight":a.preventDefault(),c(1),n(t,e.current);break;case"Home":a.preventDefault(),c(Number.NEGATIVE_INFINITY),n(t,e.current);break;case"End":a.preventDefault(),c(Number.POSITIVE_INFINITY),n(t,e.current);break}}else{const c=d=>{if(v===a.ctrlKey)return e.nav(d,l);const m=e.current;e.nav(d,l),m!==e.current&&e.input(...Q(e.model),e)};switch(a.key){case"ArrowUp":case"ArrowLeft":a.preventDefault(),c(-1);break;case"ArrowDown":case"ArrowRight":a.preventDefault(),c(1);break;case"Home":a.preventDefault(),c(Number.NEGATIVE_INFINITY);break;case"End":a.preventDefault(),c(Number.POSITIVE_INFINITY);break;case" ":a.preventDefault(),e.input(e);break}}}}}),ne=B({__name:"VListbox",props:L({disabled:{type:Boolean},options:{},clearable:{type:Boolean},listbox:{},circular:{type:Boolean},magnetic:{type:Boolean,default:!0},action:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:n}){const f=T(e,"modelValue"),t=e,p=O(),r=t.listbox||z(f,t),a=K(r),l=R(r,"current"),v=i=>C(p.default&&W(p.default({option:i}))||Y("div",i.label),{id:r.id+":"+i.index,onPointerdown:y=>y.shiftKey&&y.preventDefault(),onClick:y=>a.handlePointerdown(y,i,{magnetic:t.magnetic}),"data-key":m(i.value),role:"option","aria-selected":(Array.isArray(r.model)?r.model.includes(i.value):r.model===i.value)||void 0,class:r.current===i.index&&"current","aria-disabled":t.disabled||i.disabled||void 0}),c=i=>{var y;i.key==="Enter"?t.action?t.action(i,r):(y=d.value.closest("form"))==null||y.submit():a.handleKeydown(i,{circular:t.circular,magnetic:t.magnetic})},d=S(),m=J(r);return n({listbox:r}),(i,y)=>(w(),k("div",{ref_key:"root",ref:d,id:I(r).id,onKeydown:$(c,["self"]),role:"listbox",tabindex:t.disabled?-1:0,"aria-disabled":t.disabled,"aria-activedescendant":l.value>-1?`${I(r).id}:${l.value}`:void 0,"aria-multiselectable":I(r).multi},[(w(!0),k(N,null,_(I(r).tree,(s,u)=>(w(),k(N,{key:s&&typeof s=="object"&&"options"in s?s.title?"g"+s.title:"G"+u:I(m)(s.value)},[s&&typeof s=="object"&&"options"in s?(w(),k("div",{key:0,role:"group","aria-label":s.title},[x(i.$slots,"group",{group:s},()=>[F("h6",null,P(s.title),1)]),(w(!0),k(N,null,_(s.options,o=>(w(),j(D(v(o)),{key:I(m)(o.value)}))),128))],8,Z)):(w(),j(D(v(s)),{key:1}))],64))),128))],40,X))}});export{ne as _,z as u};
