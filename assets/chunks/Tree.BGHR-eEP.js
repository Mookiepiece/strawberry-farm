import{a as R}from"./misc.C9Tk6PVQ.js";import{d as q,A as L,B as z,a5 as I,ae as Y,f as k,c as t,E as Z,a4 as S,q as ee,o as d,j as h,r as U,a9 as le,aa as ae,F,k as K,a as O,b as _,af as H,l as M,$ as oe,ad as te,H as W,t as j,y as P,p as u,D as $,m as E}from"./framework.BjwmYqAO.js";import{s as re}from"./theme.W1H-0ptT.js";const G=Symbol("VTree"),B=new WeakMap,se=["aria-expanded","aria-busy","aria-selected","tabindex","data-level"],ne={key:0,role:"group"},ce=q({__name:"VTreeNode",props:L({level:{default:0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(T){const o=z(T,"modelValue"),p=T;I();const a=Y(G);if(!a)throw new Error;const i=k(),V=t(()=>a.current===o.value.value);Z(()=>{var l;V.value&&((l=i.value)==null||l.focus())});const v=(...l)=>{const r=[];return R(w=>r.push(w),...l),r},m=l=>!a.connected||!l.children?t(()=>({mixed:!1,unclear:!1,selected:Array.isArray(a.model)?a.model.includes(l.value):a.model===l.value})):(B.get(l)||B.set(l,t(()=>{let r=!1,w=!1,x=!1;return Array.isArray(l.children)?(x=l.children.some(C=>m(C).value.selected),w=x&&l.children.some(C=>!m(C).value.selected)):r=!0,{unclear:r,selected:x,mixed:w}})),B.get(l)),y=m(o.value),n=t(()=>y.value.selected),e=t(()=>y.value.mixed),f=t(()=>y.value.unclear),s=()=>{if(a.connected){if(f.value)return;if(!n.value||e.value){const l=v(o.value);Array.isArray(a.model)&&(l.filter(r=>!r.children).forEach(({value:r})=>{a.model.includes(r)||a.model.push(r),console.log(a.model)}),a.model=a.model)}else{const l=v(o.value);Array.isArray(a.model)&&(l.filter(r=>!r.children).forEach(({value:r})=>{a.model.includes(r)&&a.model.splice(a.model.indexOf(r),1)}),a.model=a.model)}}else{const l=o.value.value;Array.isArray(a.model)?(a.model.includes(l)?a.model.splice(a.model.indexOf(l),1):a.model.push(l),a.model=a.model):a.model=l}},c=t({get(){return!!o.value.open},set(l){o.value.open=l}}),g=t(()=>!!(Array.isArray(o.value.children)?o.value.children.length:o.value.children)),b=k(!1),A=re(async()=>{var l;try{b.value=!0;const r=o;r.value.children=await((l=a.load)==null?void 0:l.call(a,r.value))}finally{b.value=!1}}),J=async()=>{c.value=!0,o.value.children===!0&&await A()},Q=l=>{switch(l.key){case"ArrowDown":a.nav(1);break;case"ArrowUp":a.nav(-1);break;case"ArrowLeft":c.value=!1;break;case"ArrowRight":J();break;case"Enter":case" ":s();break}},X=S({value:t(()=>o.value.value),label:t(()=>o.value.label),meta:t(()=>o.value.meta),disabled:t(()=>o.value.disabled),open:t({get:()=>o.value.open,set(l){o.value.open=l,o.value=o.value}}),children:t(()=>o.value.children),current:V,selected:t({get:()=>n.value,set(l){l!==n.value&&s()}}),mixed:e,unclear:f,loading:b,level:t(()=>p.level)});return(l,r)=>{const w=ee("VTreeNode",!0);return d(),h("div",{ref_key:"el",ref:i,role:"treeitem","aria-expanded":g.value?c.value:void 0,"aria-busy":b.value,"aria-selected":n.value,onKeydown:oe(Q,["self","exact"]),tabindex:V.value?"0":"-1","data-level":l.level},[U(l.$slots,"default",le(ae({model:X}))),c.value&&Array.isArray(o.value.children)&&o.value.children.length?(d(),h("div",ne,[(d(!0),h(F,null,K(o.value.children,(x,C)=>(d(),O(w,{modelValue:o.value.children[C],"onUpdate:modelValue":D=>o.value.children[C]=D,level:l.level+1,key:x.value},{default:_(D=>[U(l.$slots,"default",H({ref_for:!0},D))]),_:2},1032,["modelValue","onUpdate:modelValue","level"]))),128))])):M("",!0)],40,se)}}}),N=q({__name:"VTree",props:L({connected:{type:Boolean},tree:{default:()=>[]},load:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(T,{expose:o}){const p=z(T,"modelValue"),a=T;I();const i=t(()=>S(a.tree)),V=(...s)=>{const c=[];return R(g=>c.push(g),...s),c},v=t(()=>V(...i.value)),m=k(null),y=t({get(){return v.value.some(s=>s.value===m.value)?m.value:v.value[0].value},set(s){m.value=s}}),n=s=>{const c=v.value[v.value.findIndex(({value:g})=>g===y.value)+s];c&&(y.value=c.value)};te(G,S({model:t({get(){return p.value},set(s){p.value=s}}),tree:i,connected:t(()=>a.connected),load:t(()=>a.load),current:y,nav:n}));const e=k(),f=()=>{var s,c;return(c=(s=e.value)==null?void 0:s.querySelector('[role="treeitem"][tabindex="0"]'))==null?void 0:c.focus()};return o({el:e}),(s,c)=>(d(),h("div",{ref_key:"el",ref:e,role:"tree",class:"VTree",tabindex:"-1",onFocus:f},[(d(!0),h(F,null,K(i.value,(g,b)=>(d(),O(ce,{key:g.value,modelValue:i.value[b],"onUpdate:modelValue":A=>i.value[b]=A},{default:_(A=>[U(s.$slots,"default",H({ref_for:!0},A),()=>[W(j(A.model.label??A.model.value),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))],544))}}),ue={class:"[A] gap-2"},de=["onClick"],ie=["i"],ve={key:1,style:{width:"1em","aspect-ratio":"1"}},me=["onClick","i"],fe=["onClick","i"],he=["onClick"],pe=["i"],Ve=["onClick","i"],ye=["onClick"],ke=["i"],Te=q({__name:"Tree",setup(T){const o=()=>[{value:"Projects",children:[{value:"Project-1"},{value:"Project-2"},{value:"Project-3",children:[{value:"Project-3A"},{value:"Project-3B"},{value:"Project-3C"}]},{value:"Project-4"},{value:"Project-5",children:[{value:"Project-5A"},{value:"Project-5B"},{value:"Project-5C"}]}]},{value:"Reports"},{value:"Letters"}],p=o(),a=o(),i=k(null),V=k([]),v=k([]),m=k([]);return(y,n)=>(d(),h(F,null,[W(j(P(p))+" ",1),u("div",ue,[$(N,{class:"VTreeDemo",modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=e=>i.value=e),tree:P(p)},null,8,["modelValue","tree"]),$(N,{class:"VTreeDemo2",modelValue:V.value,"onUpdate:modelValue":n[1]||(n[1]=e=>V.value=e),tree:P(p)},{default:_(({model:e})=>[u("div",{class:"VTreeDemo2A",style:E({"--level":e.level})},[u("div",{class:"VTreeDemo2B",onClick:f=>e.open=!e.open},[e.children?(d(),h("i-feather",{key:0,i:e.open?"chevron-down":"chevron-right"},null,8,ie)):(d(),h("div",ve)),u("div",null,j(e.label??e.value),1)],8,de),u("i-feather",{class:"VTreeDemo2C",onClick:f=>e.selected=!e.selected,i:e.selected?"check-circle":"circle"},null,8,me)],4)]),_:1},8,["modelValue","tree"]),$(N,{class:"VTreeDemo3",modelValue:v.value,"onUpdate:modelValue":n[2]||(n[2]=e=>v.value=e),tree:P(a)},{default:_(({model:e})=>[u("div",{class:"VTreeDemo3A",style:E({"--level":e.level})},[e.children?(d(),h("i-feather",{key:0,class:"VTreeDemo3B",onClick:f=>e.open=!e.open,i:e.open?"chevron-down":"chevron-right"},null,8,fe)):M("",!0),u("div",{class:"VTreeDemo3C",onClick:f=>e.selected=!e.selected},[u("div",null,j(e.label??e.value),1),u("i-feather",{i:e.selected?"check-circle":"circle"},null,8,pe)],8,he)],4)]),_:1},8,["modelValue","tree"]),$(N,{class:"VTreeDemo3",modelValue:m.value,"onUpdate:modelValue":n[3]||(n[3]=e=>m.value=e),tree:P(a),connected:""},{default:_(({model:e})=>[u("div",{class:"VTreeDemo3A",style:E({"--level":e.level})},[e.children?(d(),h("i-feather",{key:0,class:"VTreeDemo3B",onClick:f=>e.open=!e.open,i:e.open?"chevron-down":"chevron-right"},null,8,Ve)):M("",!0),u("div",{class:"VTreeDemo3C",onClick:f=>e.selected=!e.selected},[u("div",null,j(e.label??e.value),1),u("i-feather",{i:e.mixed?"square":e.selected?"check-circle":"circle"},null,8,ke)],8,ye)],4)]),_:1},8,["modelValue","tree"])])],64))}});export{Te as default};
